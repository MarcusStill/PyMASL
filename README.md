# PyMASL
## Программа учета посетителей и реализации услуг для детских развлекательных центров


Она позволяет вести учет посетителей детского центра и реализовывать услуги с использованием торгового оборудования.

## Реализованный функционал

- учет сведений о клиентах;
- продажа билетов: формирование заказов, сохранение для последующей оплаты, привязка к сопровождающему, применение различных скидок (многодетные, инвалиды, скидки по этапам 5%);
- соблюдение правил посещения детского центра при оформлении заказов;
- выполнение операций с торговым оборудованием: ведение денежных операций при помощи ККМ АТОЛ, работа с эквайринговым терминалом ПАО Сбербанк, генерация и печать входных билетов;
- ведение статистики продаж и посещений;
- формирование отчетности.

> Внедрение проекта началось 01.06.2022 г. После стадии опытной эксплуатации организация перешла на реализацию своих услуг только с использованием данного ПО.

## Статистика по продажам

- В 2022 году: 1,7 млн. руб.
- В 2023 году: 7,6 млн. руб.
- На октябрь 2024 года: 3,9 млн. руб.



## Используемые технологии

PyMASL написан на Python и использует ряд проектов с открытым исходным кодом:
- В качестве СУБД используется [PostgreSQL](https://www.postgresql.org/).
- Для безопасного изменения состояния БД используется инструмент для управления миграциями [Alembic](https://alembic.sqlalchemy.org/).
- Для работы с БД используется ORM инструмент [SQLAlchemy](https://www.sqlalchemy.org/).
- Графический интерфейс создан при помощи [PySide6](https://pypi.org/project/PySide6/), предоставляющего доступ ко всему фреймворку Qt 6.0+. Формы разработаны в Qt Designer.
- Для запуска программы в ОС Windows проект конвертируется в исполняемый exe файл при помощи [Auto PY to EXE](https://pypi.org/project/auto-py-to-exe/) (графический интерфейс к PyInstaller).
- Для работы с эквайринговые терминалы PAX/Ingenico используется утилита loadparm.exe.
- Для работы с онлайн-кассами АТОЛ FPrint-22ПТК используется драйвер контрольно-кассовой техники v.10 [дККТ10](https://integration.atol.ru/api/).
- Для генерации форм различных документов используется библиотека [ReportLab](https://www.reportlab.com/).
- Для формирования pdf документов используется [SumatraPDF](https://www.sumatrapdfreader.org/).

И, конечно же, PyMASL это open source проект, размещенный в [публичном репозитории](https://github.com/MarcusStill/PyMASL) на GitHub.

## Интерфейс.
При запуске проекта отображается форма идентификации.

![0](https://github.com/user-attachments/assets/052e3ed4-9045-4915-ae57-ead3c6cee932)

После успешной аутентификации пользователя открывается главная форма приложения. Она состоит из следующих вкладок: посетители, продажи, доп.услуги, статистика, касса.

#### Вкладка "Посетители".
На ней отображается список всех клиентов. Доступны следующие фильтры: фамилия и имя, фамилия, номер телефона, статус "инвалид", статус "многодетный". Например, фильтр по фамилии и имени "ива алекс" отфильтрует всех клиентов фамилия которых начинается с "ива" и имя начинается с "алекс").
![1](https://github.com/user-attachments/assets/fd71e9cc-606c-4603-b87f-270eeef438f3)

При нажатии на кнопку "добавить" открывается форма для внесения сведений о новом посетителе. Кнопка "изменить" откроет окно для редактирования информации о клиенте.

![2](https://github.com/user-attachments/assets/56efe771-a520-4664-88c0-4dc4233d724c)

#### Вкладка "Продажи".
На ней отображаются сведения о всех оформленных продажах билетов. Доступны следующие фильтры: текущий день, 3 дня и 7 дней.
![3](https://github.com/user-attachments/assets/2a001c31-0a1e-4341-b7a9-fe1cebdb5215)

При нажатии на кнопку "новая" открывается форма для формирования новой продажи. Она разделена на несколько частей. Верхняя таблица (далее таблица клиенты) используется для отображения перечня клиентов в соответствии с выбранным вариантом фильтрации (по тем же принципам, как и на вкладке "посетители"). Кнопка "новый" позволяет внести в базу данных нового клиента, а кнопка "+" сразу добавляет его в продажу. Кнопка "изменить" открывает форму со сведениями о посетителе для их корректировки. В таблицу, расположенную в правой части формы продажи, выводится список посетителей, которые были вместе в одной продаже ранее. В таблицу, расположенную в нижней части формы (далее таблица "заказ"), двойным кликом добавляются гости из таблицы "клиенты" для формирования продажи.
На форме "продажи" присутствует поле с выбором даты посещения и выпадающий список с выбором продолжительности посещения. Checkbox "продление в день многодетных" позволяет оформить дополнительную продажу для посетителей со статусом многодетный в первое воскресение месяца. Продажу с определенным перечнем гостей можно сформировать заранее.

Двойным кликом на уже оформленной продаже открывается окно с просотром подробной информации.
![4](https://github.com/user-attachments/assets/267cc809-670b-4d7e-9fca-94e0d0e03d74)

В зависимости от возраста посетители делятся на следующие группы:
- младше 5 лет получают бесплатный билет;
- от 5 до 14 лет получают детский билет;
- старше 14 лет получают взрослый билет.

Цена билета автоматически рассчитывается в зависимости от возраста и категории посетителя. Реализован следующий механизм расчета:
- многодетным в будние дни предоставляется скидка 50%;
- в первое воскресение месяца многодетным предоставляется бесплатный билет на два часа;
- инвалидам предоставляется бесплатное посещение в любой день с одним сопровождающим.
В соответствии с ценовой политикой организации стоимость билета в будний день может отличаться от цены билета в выходной день. Статус дня, в котором оформляется заказ, рассчитывается автоматически. Возможен как учет дополнительных праздничных дней, так и "внеплановых" рабочих дней.
Возможно применение скидки с шагом в 5% к каждой позиции в таблице "заказы". Продажа "привязывается" к взрослому посетителю. Если он не хочет посещать развлекательный центр - его можно исключить из продажи.

#### Вкладка "Доп.услуги".
Предполагается реализация дополнительных услуг: дни рождения, дискотеки и т.д. 
> Примечание: данный функционал находится в стадии разработки.

#### Вкладка "Статистика".
На ней формируются сведения о продажах за выбранный период. Формируются следующие показатели:
- количество проданных билетов в разрезе по времени посещения и категории посетителя;
- финансовые показатели с разбивкой по способу оплаты и рабочему месту.
![5](https://github.com/user-attachments/assets/3aaa3661-3402-41cd-8b54-d12280ccbb5b)

Для получения сведений нужно выбрать временной диапазон и нажать на кнопку "сформировать". После этого можно сгенерировать отчет кассира и администратора.

![6](https://user-images.githubusercontent.com/69536339/182664347-2de36ef2-191f-4476-b599-b7b207358af1.jpg)

![7](https://user-images.githubusercontent.com/69536339/182665904-ddcece38-9dc6-4cb4-a6b6-a701c4d2c165.jpg)


#### Вкладка "Касса".
На ней расположены кнопки для работы с банковским терминалом и кассовым аппаратом.
![8](https://github.com/user-attachments/assets/29c12245-6c2c-4bab-9fce-4377f335acb0)


## Установка и запуск проекта
1. **Клонирование репозитория**

```bash
git clone https://github.com/MarcusStill/PyMASL.git
cd PyMASL
```
### 2. Создание виртуального окружения
Проект использует зависимости, указанные в файле requirements.txt. Рекомендуется установить их в виртуальное окружение.
```bash
python -m venv venv
source venv/bin/activate  # для Linux/MacOS
venv\Scripts\activate  # для Windows
```
### 3. Установка зависимостей
```bash
pip install -r requirements.txt
```
### 4. Запуск проекта
```bash
python main.py
```
#### Примечание
Для работы в ОС Windows проект конвертируется в исполняемый exe файл при помощи [Auto PY to EXE](https://pypi.org/project/auto-py-to-exe/) - GUI к PyInstaller.
Конфигурация, необходимая для сборки проекта, сохранена в файле pyinstaller_conf.json. В нем надо заменить PATH на локальный путь к папке с проектом.
В каталоге Files/platforms расположены необходимые для работе в ОС Windows ddl.

## Лицензия

PyMASL является open-source проектом, написанным на Python. Проект использует библиотеки и инструменты, выпущенные под различными лицензиями:

- PostgreSQL: ([PostgreSQL License](https://www.postgresql.org/about/licence/))
- Alembic: ([MIT License](https://github.com/sqlalchemy/alembic/blob/master/LICENSE))
- SQLAlchemy: ([MIT License](https://github.com/sqlalchemy/sqlalchemy/blob/main/LICENSE))
- PySide6: ([LGPL v3](https://doc.qt.io/qtforpython/licenses.html))
- Auto PY to EXE:  ([MIT License](https://github.com/brentvollebregt/auto-py-to-exe/blob/master/LICENSE))
- ReportLab: ([BSD License](https://www.reportlab.com/opensource/))
- SumatraPDF: ([GPL v3](https://www.sumatrapdfreader.org/free-pdf-reader))

Пожалуйста, ознакомьтесь с лицензиями выше, чтобы убедиться в соответствии условий использования.
